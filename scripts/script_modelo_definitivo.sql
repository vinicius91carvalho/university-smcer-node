DROP DATABASE tcc;
CREATE DATABASE tcc;

USE tcc;

DROP TABLE IF EXISTS tcc.circuito;
CREATE TABLE tcc.circuito (
  id INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  nome CHAR(255) NOT NULL,
  PRIMARY KEY(id)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

INSERT INTO circuito VALUES (1, 'FASE 1');
INSERT INTO circuito VALUES (2, 'FASE 2');
INSERT INTO circuito VALUES (3, 'Banheiro');
INSERT INTO circuito VALUES (4, 'Cozinha');
INSERT INTO circuito VALUES (5, 'Chuveiro');
INSERT INTO circuito VALUES (6, 'Porao');

DROP TABLE IF EXISTS tcc.usuario;
CREATE TABLE tcc.usuario (
  id INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  nome CHAR(255) NOT NULL,
  email CHAR(255) NOT NULL,
  senha  CHAR(64) NOT NULL,
  PRIMARY KEY(id)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

INSERT INTO usuario VALUES (null, 'admin','admin@gmail.com','admin');

DROP TABLE IF EXISTS tcc.alerta;
CREATE TABLE tcc.alerta (
  id INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  id_circuito_fk INTEGER UNSIGNED NOT NULL,
  id_usuario_fk INTEGER UNSIGNED NOT NULL,
  potencia FLOAT NOT NULL,
  habilitar TINYINT NOT NULL,
  nome VARCHAR(255) NOT NULL,
  PRIMARY KEY(id),
  INDEX alerta_fl_usuario(id_usuario_fk),
  INDEX alerta_fk_circuito(id_circuito_fk)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

INSERT INTO alerta VALUES (1, 3, 1, 1100, 1, '1100W Alerta Teste');

DROP TABLE IF EXISTS tcc.media_hora_fechada;
CREATE TABLE tcc.media_hora_fechada (
  data_hora TIMESTAMP NOT NULL,
  id_circuito_fk INTEGER UNSIGNED NOT NULL,
  potencia FLOAT NOT NULL DEFAULT 0.0,
  PRIMARY KEY(data_hora, id_circuito_fk),
  INDEX consumo_hora_fk_circuito(id_circuito_fk)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

INSERT INTO media_hora_fechada VALUES 
('2015-09-12 00:00:00', 1, 110),('2015-09-12 08:00:00', 1, 150),('2015-09-12 16:00:00', 1, 200),('2015-09-13 00:00:00', 1, 280),('2015-09-13 08:00:00', 1, 273) ,('2015-09-13 16:00:00', 1, 183),('2015-09-14 00:00:00', 1, 143),('2015-09-14 08:00:00', 1, 300),('2015-09-14 16:00:00', 1, 152),('2015-09-15 00:00:00', 1, 132),('2015-09-15 08:00:00', 1, 421),('2015-09-15 16:00:00', 1, 192),('2015-09-16 00:00:00', 1, 92),('2015-09-17 00:00:00', 1, 210),('2015-09-17 08:00:00', 1, 67),('2015-09-17 16:00:00', 1, 229),('2015-09-18 00:00:00', 6, 140),('2015-09-18 08:00:00', 6, 123),
('2015-09-12 01:00:00', 1, 110),('2015-09-12 09:00:00', 1, 150),('2015-09-12 17:00:00', 1, 200),('2015-09-13 01:00:00', 1, 280),('2015-09-13 09:00:00', 1, 273) ,('2015-09-13 17:00:00', 1, 183),('2015-09-14 01:00:00', 1, 143),('2015-09-14 09:00:00', 1, 300),('2015-09-14 17:00:00', 1, 152),('2015-09-15 01:00:00', 1, 132),('2015-09-15 09:00:00', 1, 421),('2015-09-15 17:00:00', 1, 192),('2015-09-16 01:00:00', 1, 92),('2015-09-17 01:00:00', 1, 210),('2015-09-17 09:00:00', 1, 67),('2015-09-17 17:00:00', 1, 229),('2015-09-18 01:00:00', 6, 140),('2015-09-18 09:00:00', 6, 123),
('2015-09-12 02:00:00', 1, 110),('2015-09-12 10:00:00', 1, 150),('2015-09-12 18:00:00', 1, 200),('2015-09-13 02:00:00', 1, 280),('2015-09-13 10:00:00', 1, 273) ,('2015-09-13 18:00:00', 1, 183),('2015-09-14 02:00:00', 1, 143),('2015-09-14 10:00:00', 1, 300),('2015-09-14 18:00:00', 1, 152),('2015-09-15 02:00:00', 1, 132),('2015-09-15 10:00:00', 1, 421),('2015-09-15 18:00:00', 1, 192),('2015-09-16 02:00:00', 1, 92),('2015-09-17 02:00:00', 1, 210),('2015-09-17 10:00:00', 1, 67),('2015-09-17 18:00:00', 1, 229),('2015-09-18 02:00:00', 6, 140),('2015-09-18 10:00:00', 6, 123),
('2015-09-12 03:00:00', 1, 110),('2015-09-12 11:00:00', 1, 150),('2015-09-12 19:00:00', 1, 200),('2015-09-13 03:00:00', 1, 280),('2015-09-13 11:00:00', 1, 273) ,('2015-09-13 19:00:00', 1, 183),('2015-09-14 03:00:00', 1, 143),('2015-09-14 11:00:00', 1, 300),('2015-09-14 19:00:00', 1, 152),('2015-09-15 03:00:00', 1, 132),('2015-09-15 11:00:00', 1, 421),('2015-09-15 19:00:00', 1, 192),('2015-09-16 03:00:00', 1, 92),('2015-09-17 03:00:00', 1, 210),('2015-09-17 11:00:00', 1, 67),('2015-09-17 19:00:00', 1, 229),('2015-09-18 03:00:00', 6, 140),('2015-09-18 11:00:00', 6, 123),
('2015-09-12 04:00:00', 1, 110),('2015-09-12 12:00:00', 1, 150),('2015-09-12 20:00:00', 1, 200),('2015-09-13 04:00:00', 1, 280),('2015-09-13 12:00:00', 1, 273) ,('2015-09-13 20:00:00', 1, 183),('2015-09-14 04:00:00', 1, 143),('2015-09-14 12:00:00', 1, 300),('2015-09-14 20:00:00', 1, 152),('2015-09-15 04:00:00', 1, 132),('2015-09-15 12:00:00', 1, 421),('2015-09-15 20:00:00', 1, 192),('2015-09-16 04:00:00', 1, 92),('2015-09-17 04:00:00', 1, 210),('2015-09-17 12:00:00', 1, 67),('2015-09-17 20:00:00', 1, 229),('2015-09-18 04:00:00', 6, 140),('2015-09-18 12:00:00', 6, 123),
('2015-09-12 05:00:00', 1, 110),('2015-09-12 13:00:00', 1, 150),('2015-09-12 21:00:00', 1, 200),('2015-09-13 05:00:00', 1, 280),('2015-09-13 13:00:00', 1, 273) ,('2015-09-13 21:00:00', 1, 183),('2015-09-14 05:00:00', 1, 143),('2015-09-14 13:00:00', 1, 300),('2015-09-14 21:00:00', 1, 152),('2015-09-15 05:00:00', 1, 132),('2015-09-15 13:00:00', 1, 421),('2015-09-15 21:00:00', 1, 192),('2015-09-16 05:00:00', 1, 92),('2015-09-17 05:00:00', 1, 210),('2015-09-17 13:00:00', 1, 67),('2015-09-17 21:00:00', 1, 229),('2015-09-18 05:00:00', 6, 140),('2015-09-18 13:00:00', 6, 123),
('2015-09-12 06:00:00', 1, 110),('2015-09-12 14:00:00', 1, 150),('2015-09-12 22:00:00', 1, 200),('2015-09-13 06:00:00', 1, 280),('2015-09-13 14:00:00', 1, 273) ,('2015-09-13 22:00:00', 1, 183),('2015-09-14 06:00:00', 1, 143),('2015-09-14 14:00:00', 1, 300),('2015-09-14 22:00:00', 1, 152),('2015-09-15 06:00:00', 1, 132),('2015-09-15 14:00:00', 1, 421),('2015-09-15 22:00:00', 1, 192),('2015-09-16 06:00:00', 1, 92),('2015-09-17 06:00:00', 1, 210),('2015-09-17 14:00:00', 1, 67),('2015-09-17 22:00:00', 1, 229),('2015-09-18 06:00:00', 6, 140),('2015-09-18 14:00:00', 6, 123),
('2015-09-12 07:00:00', 1, 110),('2015-09-12 15:00:00', 1, 150),('2015-09-12 23:00:00', 1, 200),('2015-09-13 07:00:00', 1, 280),('2015-09-13 15:00:00', 1, 273) ,('2015-09-13 23:00:00', 1, 183),('2015-09-14 07:00:00', 1, 143),('2015-09-14 15:00:00', 1, 300),('2015-09-14 23:00:00', 1, 152),('2015-09-15 07:00:00', 1, 132),('2015-09-15 15:00:00', 1, 421),('2015-09-15 23:00:00', 1, 192),('2015-09-16 07:00:00', 1, 92),('2015-09-17 07:00:00', 1, 210),('2015-09-17 15:00:00', 1, 67),('2015-09-17 23:00:00', 1, 229),('2015-09-18 07:00:00', 6, 140),('2015-09-18 15:00:00', 6, 123);

DROP TABLE IF EXISTS tcc.media_hora_aberta;
CREATE TABLE tcc.media_hora_aberta (
  data_hora TIMESTAMP NOT NULL,
  id_circuito_fk INTEGER UNSIGNED NOT NULL,
  potencia FLOAT NOT NULL DEFAULT 0.0,
  PRIMARY KEY(id_circuito_fk),
  INDEX consumo_media_hora_fk_circuito(id_circuito_fk)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

INSERT INTO media_hora_aberta VALUES ('2015-09-12 15:00:08',1,100),('2015-09-12 15:00:08',2,40),('2015-09-12 15:00:08',3,70),('2015-09-12 15:00:08',4,51),('2015-09-12 15:00:08',5,31),('2015-09-12 15:00:08',6,141);
  
DROP TABLE IF EXISTS tcc.instantaneo;
CREATE TABLE tcc.instantaneo (
  hora TIME NOT NULL,
  id_circuito_fk INTEGER UNSIGNED NOT NULL,
  potencia FLOAT NOT NULL DEFAULT 0.0,
  PRIMARY KEY(hora, id_circuito_fk),
  INDEX consumo_instantaneo_fk_circuito(id_circuito_fk)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

INSERT INTO instantaneo VALUES('15:00:08',1,220),('15:00:08',2,110),('15:00:08',3, 440),('15:00:08',4, 167),('15:00:08',5, 563),('15:00:08',6,563);